# Pivot tables with additional attributes

Today I was working on a system that would attach tasks to users. As well as this, each user could vote for that task.

By default pivot tables connects one table to the other, but what if you have different actions for the same thing? You can add custom attributes to each pivot table! In my case, the `task_user` table had an additional attribute called `type`, and it's primary key modified to include this.

## Migration

This is the default pivot table generated by [Laracasts's L5 Generators](https://github.com/laracasts/Laravel-5-Generators-Extended), modified to include a new indexed string called `type`. It's important to ensure this is also included as part of the primary key.

    Schema::create('task_user', function (Blueprint $table) {
        $table->integer('task_id')->unsigned()->index();
        $table->foreign('task_id')->references('id')->on('tasks')->onDelete('cascade');
        $table->integer('user_id')->unsigned()->index();
        $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
        $table->string('type')->index();
        $table->primary(['task_id', 'user_id', 'type']);
    });

## Model Relationship

You need to repeat this for each type you need.

    public function usersVoted()
    {
        return $this->belongsToMany('App\User')
                    ->wherePivot('type', '=', 'voted');
    }

## Attaching Models

Turns out you still need to provide the type even if this is defined in your relationship.

    $task->usersVoted()
         ->attach($user->id, ['type' => 'voted']);

## Detaching Model

Detaching knows about your `wherePivot` so doesn't need to know the attribute:

    // Detach all the users
    $task->usersVoted()->detach();
    // Detach one user
    $task->usersVoted()->detach($user->id);
